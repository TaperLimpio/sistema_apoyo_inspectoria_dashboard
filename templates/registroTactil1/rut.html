<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" 
            rel="stylesheet" 
            integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" 
            crossorigin="anonymous">
        <link rel="stylesheet" 
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <title>Ingrese su rut</title>
        <style>
            body {
                background-color: #142c7a;
                color: #bfc4ff;
                font-family: Arial, sans-serif;
            }
            .pad_numerico button {
                background-color: #7278d3;
                color: white;
            }
            .pad_numerico button:focus {
                background-color: #565ba9;
                color: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row min-vh-100">
                <div class="col d-flex align-items-center justify-content-center">
                        <form method="post" action="" class="d-flex align-items-start flex-column flex-md-row ">
                            <div class="pad_numerico me-md-4" role="group" aria-label="Pad numérico">
                                <div class="rut-input m-3">
                                    {% csrf_token %}
                                    {{ form.as_p }}
                                    <!-- <input id="id_rut" name="rut" type="text" class="form-control" 
                                        maxlength="12" autocomplete="off" inputmode="numeric"
                                        placeholder="Ingrese su rut" />
                                    -->
                                </div>
                                <div class="row g-2">
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="7">7</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="8">8</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="9">9</button></div>

                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="4">4</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="5">5</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="6">6</button></div>

                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="1">1</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="2">2</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="3">3</button></div>

                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="0">0</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" value="K">K</button></div>
                                    <div class="col-4"><button type="button" class="btn btn_num btn-lg w-100" id="borrar"><i class="bi bi-backspace"></i></button></div>
                                    <div class="col-4"><button type="submit" class="btn btn-lg w-100"><i class="bi bi-check"></i></button></div>
                                </div>
                            </div>
                        </form>
                </div>
                <div class="col d-flex align-items-center">
                    <h3 class="mt-2">Ingrese su RUT</h3>
                </div>
            </div>
        </div>
    </div>
    </body>
    <script>
        const borrar = document.getElementById("borrar");
        const botones = document.querySelectorAll(".btn_num");
        function retrocederRut(){
            var rut = document.getElementById("id_rut");
            
            if (!rut || !rut.value) return;
            
            var nuevo_rut = rut.value.slice(0, -1);
            
            if (nuevo_rut.endsWith('-')) {
                nuevo_rut = nuevo_rut.slice(0, -1);
            }
            
            rut.value = nuevo_rut;
        }

        function ingresarNum(num){
            var rut = document.getElementById("id_rut");       
            if (!rut) {
                console.error("ERROR: No se encontró elemento id_rut");
                return;
            } 
            var currentVal = rut.value || "";
            var currentLen = currentVal.length;
            
            if(num == "K"){
                if (currentLen == 9 && currentVal[8] == "-") {
                    rut.value = currentVal + num;
                } else if (currentLen == 8) {
                    rut.value = currentVal + "-" + num;
                } else {
                }
            } else {

                if (currentLen < 8) {
                    rut.value = currentVal + num;
                } 
                else if (currentLen == 8) {
                    rut.value = currentVal + "-" + num;
                } else {
                    console.log("ya alcanzó el límite");
                }
            }
        }

        if (borrar) {
            borrar.addEventListener("click", function (event) {
                event.preventDefault();
                retrocederRut();
            });
        } else {
            console.error("Botón borrar no encontrado");
        }

        botones.forEach((boton, index) => {
            // Excluir el botón de borrar
            if (boton.id === "borrar") {
                return;
            }
            boton.addEventListener("click", function (event) {
                event.preventDefault();
                ingresarNum(boton.value);
            });
        });
    </script>
</body>
</html>
