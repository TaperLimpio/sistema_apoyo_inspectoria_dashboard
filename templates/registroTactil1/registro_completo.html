<!doctype html>
{% load static %}
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- Redirige automáticamente a la vista 'rut' después de 10 segundos -->
        <meta http-equiv="refresh" content="10;url={% url 'rut' %}">
        <title>Registro Completo</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
        />
        <style>
            body {
                background-color: #142c7a;
                color: #bfc4ff;
                text-align: center;
                font-family: Arial, sans-serif;
            }
            .check {
                background-color: #7278d3;
                border-radius: 50%;
                width: 100px;
                height: 100px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 40px auto;
            }
            .check i {
                font-size: 3rem;
                color: white;
            }
        </style>
    </head>
    <body>
        <div class="container mt-5">
            <img
                src="{% static 'escudo.png' %}"
                alt="escudo"
                style="width: 100px"
            />
            <h3 class="mt-4">Registro completo</h3>
            <p>espere a que lo atienda un inspector</p>
            <div class="check">
                <i class="bi bi-check-lg"></i>
            </div>
            {% if qr %}
            <div class="mt-4">
                <p><strong>ID QR:</strong></p>
                <code id="qr_text" style="word-break: break-all;">{{ qr }}</code>
                <div class="mt-2">
                    <button class="btn btn-outline-light btn-sm" onclick="navigator.clipboard.writeText('{{ qr }}')">Copiar ID</button>
                </div>
            </div>
            {% endif %}
        </div>
        <!-- Script de respaldo: redirige a la vista 'rut' después de 10 segundos -->
        <script>
            // Usar setTimeout para redirección más controlada
            setTimeout(function() {
                window.location.href = "{% url 'rut' %}";
            }, 10000); // 10000 ms = 10 segundos
        </script>
        {% if qr %}
        <!-- QRCODE renderer (qrcodejs) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const qrVal = "{{ qr }}";
                try {
                    const container = document.createElement('div');
                    container.className = 'mt-3';
                    container.id = 'qrcode';
                    document.querySelector('.container').appendChild(container);
                    new QRCode(container, {
                        text: qrVal,
                        width: 140,
                        height: 140,
                    });
                } catch (e) {
                    console.warn('QR render failed', e);
                }
            });
        </script>
        {% endif %}
    </body>
</html>
